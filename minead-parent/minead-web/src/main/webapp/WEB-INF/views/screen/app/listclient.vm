#@screen({"title":"客户端查询"})  
<div class="g-grid-9"> 
#@panel({"name":"mainPanel","title":"详细"})  
        #@form({"name":"searchForm"})  
            #@panel({"title":"查询条件"})  
               #textfield({"label":"名称", "name":"name","value":"","defValue":""})  
               #textfield({"label":"当前IP", "name":"currentIp","value":"","defValue":""})  
                #button_group({"buttons":[  
                    {"label":"查询","event":"queryData()","className":"u-btn-primary"}  
                ]})  
            #end  
        #end  
        #datagrid({  
            "id":"dataTable",  
            "name":"dataTable",  
            "bindFormName":"searchForm",  
            "title":"查询列表",    
            "autoLoad":true,  
            "url":"/client/list.json",  
            "items":[ 
                {"name":"id",  
                "text":"id",  
                "hAlign":"center",  
                "tAlign":"center",  
                "hidden":true  
                },  
                {"name":"groupId",  
                "text":"groupId",  
                "hAlign":"center",  
                "tAlign":"center",  
                "hidden":true  
                },  
                {"name":"name",  
                "text":"名称",  
                "hAlign":"center",  
                "tAlign":"center"  
                },  
                {"name":"groupName",  
                "text":"组名",  
                "hAlign":"center",  
                "tAlign":"center"  
                },  
                {"name":"mac",  
                "text":"mac",  
                "hAlign":"center",  
                "tAlign":"center",  
                "width":150  
                },  
                {"name":"currentIp",  
                "text":"当前IP",  
                "hAlign":"center",  
                "tAlign":"center"  
                },  
                {"name":"sysOs",  
                "text":"操作系统",  
                "hAlign":"center",  
                "tAlign":"center"  
                },  
                {"name":"status",  
                "text":"系统状态",  
                "hAlign":"center",  
                "tAlign":"center" ,
    			  "hidden":true  
                },  
                {"name":"statusCn",  
                "text":"系统状态",  
                "hAlign":"center",  
                "tAlign":"center"  
                } ,
                {"name":"preAccessTime",  
                "text":"preAccessTime",  
                "hAlign":"center",  
                "tAlign":"center",
				"hidden":true  
                },
                {"name":"preAccessTimeStr",  
                "text":"上次访问时间",  
                "hAlign":"center",  
                "tAlign":"center"
                },
                {"name":"effectTime",  
                "text":"effectTime",  
                "hAlign":"center",  
                "tAlign":"center",
				"hidden":true  
                },
                {"name":"effectTimeStr",  
                "text":"生效时间",  
                "hAlign":"center",  
                "tAlign":"center"
                },
    			{  
                    "name":"operation",  
                    "text":"操作",  
                    "hAlign":"center",  
                    "tAlign":"center",  
                    "hidden":false,  
                    "width":"200",  
                    "buttons":[{"label":"修改","event":"edit"},{"label":"重置组","event":"resetGroup"},{"label":"删除","event":"del"}]
    			}
            ],  
            "numbercolumn":"true",  
            "pageConfig":{"pageSize":10,"pageNo":1},  
            "rowSelect":"false",  
            "hasPage":"true",  
            "events":[{"event":"rowClick","function":"queryTableClick"},  
                     {"event":"rowDblclick","function":"queryTableDbClick"}]  
           })  
                
        #@window({"title":"编辑窗口", "name":"adclientEdit", "width":"750", "height":"250",  
                "buttons":[  
                    {"label":"提交","event":"saveData()","className":"u-btn-primary"},  
                    {"label":"重置","event":"resetDataForm()"}  
                ]})  
            #@form({"name":"adclientEditForm","url":""})  
                #@panel({})  
					#typefield({"label":"id", "name":"id","value":"","defValue":"","check":"required","hidden":true})
                    #textfield({"label":"名称", "name":"name","value":"","defValue":"","check":"required"})  
                    #textfield({"label":"mac地址","name":"mac","value":""})  
                    #textfield({"label":"操作系统","name":"sysOs","value":""})  
    				#combox({"name":"status","label":"状态","value":"1",  "dictName": "0004",  "check": "required"})
                    #combox({"name":"groupId","id":"groupIdEdit","label":"选择组","defValue":"","check":"required", "dictName": "weightGroupTree"})
					#calendar({"label":"生效日期", "name":"effectTimeStr","check":"required","config":"{minDate:'2013-12-23', noToday:true, format:'yyyy-MM-dd HH:mm:ss'}"})
					#textfield({"label":"当前状态","name":"statusCn","value":""})  
                #end  
            #end  
        #end  
 #end 
</div>
<div class="g-grid-3">  
#@panel({"name":"mainPanel","title":"树结构"})  
           #mieadZtree({  
             "id":"tree1",  
             "name":"ztree1",
			 "toolbar":false,
			 "search":true,
			 "autoParam":'["id", "name"]',    
			 "nodeclick":"treeclick",
             "async":true,
			 "buttons":[{"id":"treeAdd","name":"添加","click":"treeAddclick()"},{"id":"treeUpdate","name":"修改名称","click":"treeUpdateClick()"},{"id":"treeDel","name":"删除","click":"treeclick()"}],
             "url":"$appServer.get('/adweightgroup/root')"})
#end  
            
</div>
  
  
    #jscode()  
		
		function treeNodeClick(id){
			Horn.getComp("dataTable").baseParams={"groupId":id};
       		Horn.getComp("dataTable").load();  
			Horn.getComp("dataTable").baseParams={};
		}
		
	
        var action = "";  
      
        function investDetailCodeRender(data){  
           return '<font style="color:red;">'+data.val+'</font>';  
        }  
          
        function queryTableClick(rowData){  
          
        }  
        function queryTableDbClick(rowData){  
            edit(rowData);  
        }  
          
        function successCallback() {  
              
        }  
          
        function add(rowData){  
         		Horn.getComp("adclientAdd").hide();  
        		var data = $("form[name='adclientAddForm']").serializeJSON();
            	$.post("${imageServer}/adclient/addadclient",data,function(backData){
            		if(backData){
            			if(backData.success){
            				 Horn.getComp("adclientTable").load();  
            				 Horn.Tip.success("添加成功"); 
            			 }else{
            				Horn.Tip.warn(backData.errorMesg); 
            			 }
            		 }
            	},"json")
        }  
          
        function edit(rowData){  
            rowDatarowData = rowData || Horn.getComp('dataTable').getSelecteds().length && (Horn.getComp('dataTable').getSelecteds())[0];  
            Horn.getComp("adclientEditForm").setValues(rowData.rowdata);  
            Horn.getComp("adclientEdit").show();  
        }  
          
        function del(rowData){  
           Horn.Tip.info("删除成功");  
        }  
		
	 function resetGroup(rowData){  
			  Horn.Msg.confirm("确认","这是一条确认信息",function(){  
			  	 rowDatarowData = rowData || Horn.getComp('dataTable').getSelecteds().length && (Horn.getComp('dataTable').getSelecteds())[0];  
                   var id =  rowData.rowdata.id;  
            	   	$.post("${imageServer}/client/resetGroup",{"id":id},function(backData){
                		if(backData){
                			if(backData.success){
                				 Horn.getComp("dataTable").load();  
                				   Horn.Tip.success("重置成功");  
                			 }else{
                				Horn.Tip.warn(backData.errorMesg); 
                			 }
                		 }
                	},"json")
            },function(){  
                log("确认框的取消执行了")  
            });
    } 
	 function del(rowData){  
			  Horn.Msg.confirm("确认","这是一条确认信息",function(){  
			  	 rowDatarowData = rowData || Horn.getComp('dataTable').getSelecteds().length && (Horn.getComp('dataTable').getSelecteds())[0];  
                   var id =  rowData.rowdata.id;  
            	   	$.post("${imageServer}/client/deleteadclient",{"id":id},function(backData){
                		if(backData){
                			if(backData.success){
                				 Horn.getComp("dataTable").load();  
                				   Horn.Tip.info("删除成功");  
                			 }else{
                				Horn.Tip.warn(backData.errorMesg); 
                			 }
                		 }
                	},"json")
            },function(){  
                log("确认框的取消执行了")  
            });
    } 
		
    function saveData() {  
		Horn.getComp("adclientEdit").hide();  
    		//JSON.stringify($("form[name='adclientEditForm']").serializeJSON());
    	var data = $("form[name='adclientEditForm']").serializeJSON();
    	$.post("${imageServer}/client/updateadclient",data,function(backData){
    		if(backData){
    			if(backData.success){
    				 Horn.getComp("dataTable").load();  
    				 Horn.Tip.success("更新成功"); 
    			 }else{
    				Horn.Tip.warn(backData.errorMesg); 
    			 }
    		 }
    	},"json")
    }  
          
        function resetDataForm() {  
            Horn.getComp("paramform").reset();  
        }  
          
        function queryData() {  
       		 Horn.getComp("dataTable").load();  
        }  
    #end  
 #end  
