#@screen({"title":"客户端查询"})  
    #@form({"name":"searchForm"})  
        #@panel({"title":"查询条件"})  
           #textfield({"label":"名称", "name":"name","value":"","defValue":""})  
            #button_group({"buttons":[  
                {"label":"查询","event":"queryData()","className":"u-btn-primary"}  
            ]})  
        #end  
    #end  
    #datagrid({  
        "id":"dataTable",  
        "name":"dataTable",  
        "bindFormName":"searchForm",  
        "title":"查询列表",    
        "autoLoad":true,  
        "url":"/task/listtask.json",  
		   "buttons":[{"label":"新增","cls":"add","event":"add()"}
                  ],
        "items":[ 
            {"name":"id",  
            "text":"id",  
            "hAlign":"center",  
            "tAlign":"center",  
            "hidden":true  
            },  
            {"name":"name",  
            "text":"名称",  
            "hAlign":"center",  
            "tAlign":"center"  
            },  
            {"name":"count",  
            "text":"运行数",  
            "hAlign":"center",  
            "tAlign":"center" 
            },  
            {"name":"type",  
            "text":"type",  
            "hAlign":"center",  
            "tAlign":"center" ,
			 "hidden":true 
            },  
            {"name":"typeCn",  
            "text":"类型",  
            "hAlign":"center",  
            "tAlign":"center"  
            },  
            {"name":"status",  
            "text":"状态",  
            "hAlign":"center",  
            "tAlign":"center" ,
			  "hidden":true  
            },  
            {"name":"statusCn",  
            "text":"系统状态",  
            "hAlign":"center",  
            "tAlign":"center"  
            } ,
			{"name":"clazzName",  
            "text":"执行实例",  
            "hAlign":"center",  
            "tAlign":"center"  
            } ,
            {"name":"preIssuedTime",  
            "text":"上次任务下发时间",  
            "hAlign":"center",  
            "tAlign":"center",
			"hidden":true
            } ,
            {"name":"preIssuedTimeStr",  
            "text":"上次任务下发时间",  
            "hAlign":"center",  
            "tAlign":"center"  
            } ,
            {"name":"createTime",  
            "text":"创建时间",  
            "hAlign":"center",  
            "tAlign":"center" ,
			"hidden":true
            } ,
            {"name":"createTimeStr",  
            "text":"创建时间",  
            "hAlign":"center",  
            "tAlign":"center" 
            } ,
			
            {"name":"updateTime",  
            "text":"创建时间",  
            "hAlign":"center",  
            "tAlign":"center" ,
			"hidden":true
            } ,
            {"name":"updateTimeStr",  
            "text":"创建时间",  
            "hAlign":"center",  
            "tAlign":"center" ,
			"hidden":true
            } ,
			
       
			{  
                "name":"operation",  
                "text":"操作",  
                "hAlign":"center",  
                "tAlign":"center",  
                "hidden":false,  
                "width":"200",  
                "buttons":[{"label":"修改","event":"edit"},{"label":"删除","event":"del"}]
			}
        ],  
        "numbercolumn":"true",  
        "pageConfig":{"pageSize":10,"pageNo":1},  
        "rowSelect":"false",  
        "hasPage":"true",  
        "events":[{"event":"rowClick","function":"queryTableClick"},  
                 {"event":"rowDblclick","function":"queryTableDbClick"}]  
       })  
            
    #@window({"title":"编辑窗口", "name":"w1", "width":"750", "height":"250",  
            "buttons":[  
                {"label":"提交","event":"saveData()","className":"u-btn-primary"},  
                {"label":"重置","event":"resetDataForm()"}  
            ]})  
        #@form({"name":"dataForm","url":""})  
            #@panel({})  
                #typefield({"label":"id", "name":"id","value":"","defValue":"","check":"required","hidden":true})  
                #textfield({"label":"名称", "name":"name","value":"","defValue":"","check":"required","disabled":"true"})  
                #textfield({"label":"数量", "name":"count","value":"","defValue":"","check":"required"})  
				#combox({"name":"status","label":"状态","value":"1",  "dictName": "000101",  "check": "required"})
            #end  
        #end  
    #end  
	
	
	    #@window({"title":"添加", "name":"addtask", "width":"750", "height":"250",  
            "buttons":[  
                {"label":"提交","event":"addTask()","className":"u-btn-primary"},  
                {"label":"重置","event":"resetDataForm()"}  
            ]})  
        #@form({"name":"addtaskForm","url":""})  
            #@panel({})  
                #textfield({"label":"名称", "name":"name","value":"","defValue":"","check":"required"})  
                #textfield({"label":"数量", "name":"count","value":"","defValue":"","check":"required"})  
                #textfield({"label":"组", "name":"taskGroup","value":"","defValue":"","check":"required"})  
				#combox({"name":"type","label":"类型","defValue":"",  "dictName": "0001",  "check": "required"})
				#textarea({"label":"备注","name":"descript", "cols":3}) 
            #end  
        #end  
    #end  
#end  
  
  
#jscode()  
    var action = "";  
  
      
    function add(rowData){  
        Horn.getComp("addtaskForm").reset();  
        Horn.getComp("addtask").show();  
    }  
      
    function edit(rowData){  
        rowDatarowData = rowData || Horn.getComp('dataTable').getSelecteds().length && (Horn.getComp('dataTable').getSelecteds())[0];  
        Horn.getComp("dataForm").setValues(rowData.rowdata);  
        Horn.getComp("w1").show();  
    }  
      
    function del(rowData){  
       Horn.Tip.info("删除成功");  
    }  
	
	function addTask(){
		Horn.getComp("addtask").hide();  
		var data = $("form[name='addtaskForm']").serializeJSON();
    	$.post("${imageServer}/task/add",data,function(backData){
    		if(backData){
    			if(backData.success){
    				 Horn.getComp("dataTable").load();  
    				 Horn.Tip.success("添加成功"); 
    			 }else{
    				Horn.Tip.warn(backData.errorMesg); 
    			 }
    		 }
    	},"json")
	}
	
    function saveData() {  
		Horn.getComp("w1").hide();  
    		//JSON.stringify($("form[name='dataForm']").serializeJSON());
    	var data = $("form[name='dataForm']").serializeJSON();
    	$.post("${imageServer}/task/update",data,function(backData){
    		if(backData){
    			if(backData.success){
    				 Horn.getComp("dataTable").load();  
    				 Horn.Tip.success("更新成功"); 
    			 }else{
    				Horn.Tip.warn(backData.errorMesg); 
    			 }
    		 }
    	},"json")
    }  
      
    function resetDataForm() {  
        Horn.getComp("paramform").reset();  
    }  
      
    function queryData() {  
   		 Horn.getComp("dataTable").load();  
    }  
#end  